# Profile Views Badge

## Implementation

This repository uses a **self-hosted, privacy-preserving profile views badge** powered by GitHub Actions.

### How It Works

1. **Data Source**: GitHub Traffic API (unique visitors from last 14 days)
2. **Update Frequency**: Every 6 hours via scheduled workflow
3. **Badge Format**: SVG badge matching the style of the previous komarev badge
4. **Storage**: Badge stored at `.github/profile-views.svg`

### Workflow

- **File**: `.github/workflows/profile-views.yml`
- **Schedule**: Every 6 hours (`0 */6 * * *`)
- **Manual trigger**: Available via workflow_dispatch

## Setup Instructions

### Required: Personal Access Token (PAT)

The GitHub Traffic API requires a Personal Access Token with `repo` scope. The default `GITHUB_TOKEN` in GitHub Actions doesn't have permission to access traffic data.

#### Step 1: Create a Personal Access Token

1. Go to **GitHub Settings** → **Developer settings** → **Personal access tokens** → **Tokens (classic)**
   - Direct link: https://github.com/settings/tokens
2. Click **Generate new token** → **Generate new token (classic)**
3. Configure the token:
   - **Note**: `Profile Views Badge` (or any descriptive name)
   - **Expiration**: Choose an appropriate expiration (90 days, 1 year, or no expiration)
   - **Scopes**: Select `repo` (Full control of private repositories)
     - For public repositories, you can use `public_repo` instead (more restrictive)
4. Click **Generate token**
5. **IMPORTANT**: Copy the token immediately (you won't be able to see it again!)

#### Step 2: Add Token as Repository Secret

1. Go to your repository **Settings** → **Secrets and variables** → **Actions**
   - Direct link: https://github.com/camilo-cf/camilo-cf/settings/secrets/actions
2. Click **New repository secret**
3. Configure the secret:
   - **Name**: `TRAFFIC_PAT`
   - **Secret**: Paste the token you copied in Step 1
4. Click **Add secret**

#### Step 3: Verify Setup

1. Go to **Actions** tab in your repository
2. Select **Update Profile Views Badge** workflow
3. Click **Run workflow** → **Run workflow**
4. Check that the workflow completes successfully

### Troubleshooting

If the workflow fails:

1. **Check PAT Configuration**:
   - Ensure the secret is named exactly `TRAFFIC_PAT`
   - Verify the PAT has `repo` or `public_repo` scope
   - Check that the PAT hasn't expired

2. **Check Workflow Logs**:
   - Go to Actions tab → Select the failed run
   - Review the "Fetch traffic data" step for error messages

3. **Common Issues**:
   - **Error "Resource not accessible by integration"**: PAT is missing or has insufficient permissions
   - **Error "Bad credentials"**: PAT is invalid or expired
   - **No data returned**: Repository might not have any traffic data yet (wait 24 hours after first commit)

### Privacy & Accuracy

**Advantages over third-party badges (komarev, etc.):**

✅ **Privacy**: No third-party tracking - all data from GitHub's official API
✅ **Accuracy**: Uses GitHub's actual traffic data (unique visitors)
✅ **Control**: Full ownership and transparency
✅ **Reliability**: No external service dependencies

**Trade-offs:**

⚠️ **Update frequency**: Updates every 6 hours (not real-time)
⚠️ **Commit noise**: Creates small commits when count changes (marked with `[skip ci]`)
⚠️ **Data window**: Shows unique visitors from last 14 days (GitHub API limitation)

### Badge Usage

The badge is displayed in the README:

```markdown
<img src="https://raw.githubusercontent.com/camilo-cf/camilo-cf/main/.github/profile-views.svg" alt="Profile views" />
```

### Manual Update

To manually trigger an update:

1. Go to **Actions** tab
2. Select **Update Profile Views Badge** workflow
3. Click **Run workflow**

### Technical Details

**Workflow steps:**
1. Fetch unique visitor count from GitHub Traffic API
2. Generate SVG badge with current count
3. Commit badge to `.github/profile-views.svg` (if changed)
4. Badge updates appear in README automatically (via raw.githubusercontent.com)

**Permissions required:**
- `contents: write` - To commit the updated badge
- **Personal Access Token (PAT)** with `repo` or `public_repo` scope - To access traffic data
  - Must be stored as repository secret named `TRAFFIC_PAT`
  - Default `GITHUB_TOKEN` doesn't have permission to access traffic API

**GitHub API used:**
```bash
gh api repos/{owner}/{repo}/traffic/views --jq '.uniques'
```

**Why PAT is required:**
The GitHub Traffic API is only accessible to users with push access to the repository. The default `GITHUB_TOKEN` generated by GitHub Actions doesn't have the necessary permissions to read traffic data, even with `contents: write` permission. A Personal Access Token with `repo` scope (or `public_repo` for public repositories) is required.

### Customization

To customize the badge appearance, edit the SVG template in `.github/workflows/profile-views.yml`:

- **Color**: Change the `fill` color in line: `<rect x="130" width="50" height="28" fill="#00C7B7"/>`
- **Width**: Adjust `width` attributes
- **Font**: Modify `font-family` in the text elements

### Rationale

**Why migrate from komarev?**

The previous implementation used komarev.com/ghpvc, which had several concerns:
- Privacy: Third-party service tracks every image request (IP, User-Agent, Referrer)
- Accuracy: Unknown bot filtering mechanisms
- Control: Dependency on external service availability
- Transparency: Closed-source implementation

This self-hosted solution addresses all these concerns while maintaining the same visual appearance.

---

**Note**: The badge shows unique visitors from the last 14 days, which is the data window provided by GitHub's Traffic API. This is more accurate than simple hit counters as it represents actual unique human visitors to the repository.
